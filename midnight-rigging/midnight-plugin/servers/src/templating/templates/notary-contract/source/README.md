# {{contract_name}} - Document Timestamping System

**Project**: {{TARGET_NAME}}
**Author**: {{author}}
**Created**: {{CURRENT_DATE}}
**Template**: [{{TEMPLATE_NAME}}]({{homepage}}) v{{TEMPLATE_VERSION}}

A compact document timestamping system for Pod Network with Solidity contract, Rust bindings, and CLI client.

## Installation Path

`{{TARGET_DIR}}`

## Platform

- **OS**: {{OS_TYPE}} ({{OS_ARCH}})
- **Platform**: {{OS_PLATFORM}}

## Features

- ✅ Cryptographic proof of existence for documents
- ✅ Time-based timestamp submission using Pod's Time library
- ✅ Minimum timestamp tracking (earliest timestamp wins)
- ✅ Document hash computation from files or stdin
- ✅ Human-readable timestamp formatting
- ✅ Auto-generated Rust bindings with forge bind
- ✅ Rust CLI for timestamping and verification
- ✅ Real-time event streaming for timestamp notifications
- ✅ Wait for timestamp settlement with past-perfect time

## Project Structure

```
{{TARGET_NAME}}/
├── {{contract_name}}.sol         # Solidity timestamping contract (root level)
├── foundry.toml                  # Foundry configuration
├── Makefile                      # Binding generation commands
├── Cargo.toml                    # Main Rust project manifest
├── bindings/                     # Auto-generated Rust bindings
│   ├── Cargo.toml                # Bindings crate manifest
│   └── src/                      # Generated by make generate
├── src/
│   └── main.rs                   # CLI implementation
└── README.md                     # This file
```

## Prerequisites

- **Foundry**: Required for Solidity compilation ([Install Foundry](https://book.getfoundry.sh/getting-started/installation))
- **Rust**: 2021 edition or later ([Install Rust](https://www.rust-lang.org/tools/install))
- **Pod Network Node**: Access to a local or remote Pod Network node
- **Cargo**: Package manager (comes with Rust)

## Complete Setup Workflow

This project requires a multi-step build process for generating Rust bindings from the Solidity contract.

### Step 1: Install Solidity Dependencies

Install Pod SDK for Solidity:

{{#if (eq OS_PLATFORM "win32")}}

```cmd
forge install podnetwork/pod-sdk
```

{{else}}

```bash
forge install podnetwork/pod-sdk
```

{{/if}}

### Step 2: Build the Solidity Contract

Compile the {{contract_name}} contract:

{{#if (eq OS_PLATFORM "win32")}}

```cmd
forge build
```

{{else}}

```bash
forge build
```

{{/if}}

### Step 3: Generate Rust Bindings

Create type-safe Rust bindings from the compiled contract:

{{#if (eq OS_PLATFORM "win32")}}

```cmd
make generate
```

{{else}}

```bash
make generate
```

{{/if}}

This will populate the `bindings/src/` directory with auto-generated Rust code.

### Step 4: Deploy the Contract

Deploy the contract to Pod Network and note the address:

{{#if (eq OS_PLATFORM "win32")}}

```cmd
forge create {{contract_name}}.sol:{{contract_name}} ^
  --rpc-url <your_rpc_url> ^
  --private-key <your_private_key>
```

{{else}}

```bash
forge create {{contract_name}}.sol:{{contract_name}} \
  --rpc-url <your_rpc_url> \
  --private-key <your_private_key>
```

{{/if}}

Save the deployed contract address for CLI usage.

### Step 5: Build the Rust CLI

Compile the Rust CLI application:

{{#if (eq OS_PLATFORM "win32")}}

```cmd
cargo build --release
```

{{else}}

```bash
cargo build --release
```

{{/if}}

## CLI Usage

The CLI provides three main commands: `timestamp`, `get-timestamp`, and `watch`.

### Timestamp a Document

Timestamp a document by providing its content directly or via stdin:

**From command line argument:**

```bash
cargo run -- \
  --contract-address <deployed_contract_address> \
  --rpc-url {{default_rpc_url}} \
  timestamp \
  --private-key <your_private_key> \
  "Document content here"
```

**From stdin (pipe):**

```bash
cat document.txt | cargo run -- \
  --contract-address <deployed_contract_address> \
  timestamp \
  --private-key <your_private_key>
```

**With custom timestamp (future time):**

```bash
cargo run -- \
  --contract-address <deployed_contract_address> \
  timestamp \
  --private-key <your_private_key> \
  --timestamp "2025-12-31T23:59:59Z" \
  "Important document"
```

The CLI will:

1. Compute the keccak256 hash of the document
2. Submit the timestamp to the contract
3. Wait for past-perfect time settlement
4. Verify the timestamp was recorded correctly
5. Print the document hash and timestamp

### Get Document Timestamp

Retrieve the timestamp for a previously timestamped document:

```bash
cargo run -- \
  --contract-address <deployed_contract_address> \
  get-timestamp <document_hash>
```

Example:

```bash
cargo run -- \
  --contract-address 0x12296f2D128530a834460DF6c36a2895B793F26d \
  get-timestamp 0xabc123...
```

### Watch Timestamp Events

Stream all timestamping events from the contract in real-time:

```bash
cargo run -- \
  --contract-address <deployed_contract_address> \
  watch
```

Filter events by submitter:

```bash
cargo run -- \
  --contract-address <deployed_contract_address> \
  watch \
  --from 0xSubmitterAddress
```

## How Timestamping Works

1. **Document Hashing**: CLI computes keccak256 hash of document content
2. **Timestamp Submission**: Hash and future timestamp are submitted to contract
3. **Time Validation**: Pod's Time library ensures timestamp is in the future
4. **Minimum Tracking**: If document already timestamped, keeps earliest timestamp
5. **Settlement**: CLI waits for past-perfect time to ensure immutability
6. **Verification**: Timestamp is verified on-chain

## Contract Details

- **Contract Name**: {{contract_name}}
- **Solidity Version**: ^0.8.26
- **Key Features**:
  - Time-based timestamp submission (microsecond precision)
  - Minimum timestamp tracking per document
  - Event emission for all timestamps
  - Immutable proof of existence

## Use Cases

- **Intellectual Property**: Prove document existence before patents/copyright
- **Contracts**: Timestamp agreements and legal documents
- **Audit Trails**: Create immutable records of document versions
- **Notarization**: Provide cryptographic proof without revealing content
- **Evidence**: Timestamp evidence for legal proceedings

## Development

### Modifying the Contract

If you modify `{{contract_name}}.sol`:

1. Rebuild: `forge build`
2. Regenerate bindings: `make generate`
3. Rebuild CLI: `cargo build`

### Working with Document Hashes

The CLI uses keccak256 hashing. To manually compute a hash:

```bash
echo -n "Document content" | sha3sum -a keccak256
```

Or in the CLI:

```bash
echo "Document content" | cargo run -- timestamp --private-key <key>
```

## Customization Ideas

- Add batch timestamping for multiple documents
- Implement timestamp revocation with authorization
- Add digital signature verification alongside timestamps
- Support different hashing algorithms
- Add metadata storage (file name, size, type)
- Implement merkle trees for efficient bulk timestamping
- Create web interface for document upload
- Add timestamp certificate generation (PDF)

## Dependencies

### Solidity Dependencies

- **pod-sdk** (Foundry): Time library for timestamp handling

### Rust Dependencies

- **pod-sdk** (0.5.0): Pod Network SDK
- **pod-types** (0.3.0): Pod Network types
- **{{bindings_crate_name}}**: Auto-generated contract bindings
- **alloy** (1.0.36): Ethereum types
- **tokio** (1.47.1): Async runtime
- **clap** (4.5.48): CLI parsing
- **humantime** (2.3.0): Timestamp formatting

## Troubleshooting

### Bindings Not Found

If the CLI fails to build with "cannot find crate `{{bindings_crate_name}}`":

```bash
make generate
```

### Contract Compilation Errors

Make sure Pod SDK is installed:

```bash
forge install podnetwork/pod-sdk
```

### Timestamp Must Be In Future

The contract requires future timestamps. Add 10+ seconds:

```bash
--timestamp "$(date -u -d '+10 seconds' +%Y-%m-%dT%H:%M:%SZ)"
```

### Document Has Earlier Timestamp

If a document was already timestamped with an earlier time, the contract
keeps the earliest timestamp and rejects later submissions.

## Resources

- [Pod Network Documentation]({{documentation}})
- [Pod Network Homepage]({{homepage}})
- [Repository]({{repository}})
- [Foundry Book](https://book.getfoundry.sh/)

## License

MIT

---

Generated on {{CURRENT_TIMESTAMP}}
