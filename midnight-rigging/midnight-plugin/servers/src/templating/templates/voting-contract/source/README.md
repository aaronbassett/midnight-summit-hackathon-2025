# {{contract_name}} - On-Chain Voting System

**Project**: {{TARGET_NAME}}
**Author**: {{author}}
**Created**: {{CURRENT_DATE}}
**Template**: [{{TEMPLATE_NAME}}]({{homepage}}) v{{TEMPLATE_VERSION}}

A complete on-chain voting system for Pod Network with Solidity contracts, Rust bindings, and a CLI client.

## Installation Path

`{{TARGET_DIR}}`

## Platform

- **OS**: {{OS_TYPE}} ({{OS_ARCH}})
- **Platform**: {{OS_PLATFORM}}

## Features

- ✅ On-chain proposal creation with deadlines
- ✅ Time-based deadline enforcement using Pod's Time library
- ✅ Voter registration per proposal
- ✅ Vote casting with choice parameter
- ✅ Threshold-based proposal execution
- ✅ Fast counters for efficient vote tracking
- ✅ Comprehensive Foundry test suite
- ✅ Auto-generated Rust bindings with forge bind
- ✅ Rust CLI for all voting operations
- ✅ Real-time event streaming with verification

## Project Structure

```
{{TARGET_NAME}}/
├── contract/                      # Foundry Solidity project
│   ├── src/
│   │   └── {{contract_name}}.sol  # Main voting contract
│   ├── test/
│   │   └── {{contract_name}}.t.sol # Test suite
│   ├── script/
│   │   └── {{contract_name}}.s.sol # Deployment script
│   ├── foundry.toml               # Foundry configuration
│   ├── Makefile                   # Binding generation
│   └── README.md                  # Contract documentation
├── bindings/                      # Auto-generated Rust bindings
│   ├── Cargo.toml                 # Bindings crate manifest
│   ├── src/                       # Generated by forge bind
│   └── README.md                  # Bindings documentation
├── client/                        # Rust CLI application
│   ├── src/
│   │   └── main.rs                # CLI implementation
│   ├── Cargo.toml                 # Client crate manifest
│   └── README.md                  # Client documentation (optional)
└── README.md                      # This file
```

## Prerequisites

- **Foundry**: Required for Solidity compilation and testing ([Install Foundry](https://book.getfoundry.sh/getting-started/installation))
- **Rust**: 2021 edition or later ([Install Rust](https://www.rust-lang.org/tools/install))
- **Pod Network Node**: Access to a local or remote Pod Network node
- **Cargo**: Package manager (comes with Rust)

## Complete Setup Workflow

This project requires a multi-step build process due to the interaction between Solidity contracts and Rust code.

### Step 1: Install Solidity Dependencies

Navigate to the contract directory and install Pod SDK:

{{#if (eq OS_PLATFORM "win32")}}

```cmd
cd contract
forge install podnetwork/pod-sdk
```

{{else}}

```bash
cd contract
forge install podnetwork/pod-sdk
```

{{/if}}

### Step 2: Build the Solidity Contract

Compile the {{contract_name}} contract:

{{#if (eq OS_PLATFORM "win32")}}

```cmd
forge build
```

{{else}}

```bash
forge build
```

{{/if}}

### Step 3: Run Tests (Optional but Recommended)

Verify the contract works correctly:

{{#if (eq OS_PLATFORM "win32")}}

```cmd
forge test -vvv
```

{{else}}

```bash
forge test -vvv
```

{{/if}}

### Step 4: Generate Rust Bindings

Create type-safe Rust bindings from the compiled contract:

{{#if (eq OS_PLATFORM "win32")}}

```cmd
make generate
```

{{else}}

```bash
make generate
```

{{/if}}

This will populate the `../bindings/src/` directory with auto-generated Rust code.

### Step 5: Deploy the Contract

Deploy the contract to Pod Network and note the address:

{{#if (eq OS_PLATFORM "win32")}}

```cmd
forge script script/{{contract_name}}.s.sol:{{contract_name}}Script ^
  --rpc-url <your_rpc_url> ^
  --private-key <your_private_key> ^
  --broadcast
```

{{else}}

```bash
forge script script/{{contract_name}}.s.sol:{{contract_name}}Script \
  --rpc-url <your_rpc_url> \
  --private-key <your_private_key> \
  --broadcast
```

{{/if}}

Save the deployed contract address for CLI usage.

### Step 6: Build the Rust CLI

Navigate to the client directory and build the CLI:

{{#if (eq OS_PLATFORM "win32")}}

```cmd
cd ..\client
cargo build --release
```

{{else}}

```bash
cd ../client
cargo build --release
```

{{/if}}

## CLI Usage

The CLI provides two main commands: `create` and `vote`.

### Create a Proposal

Create a new voting proposal with a deadline, participants, and threshold:

```bash
cargo run -- \
  --contract-address <deployed_contract_address> \
  --rpc-url {{default_rpc_url}} \
  create \
  --private-key <your_private_key> \
  --deadline <unix_timestamp> \
  --threshold 2 \
  --participants <voter1_address> <voter2_address> <voter3_address> \
  --data <hex_encoded_data>
```

Parameters:

- `--deadline`: Unix timestamp in seconds (optional, defaults to now + 30s)
- `--threshold`: Minimum votes needed for execution
- `--participants`: List of eligible voter addresses
- `--data`: Hex-encoded proposal data

Example:

```bash
cargo run -- \
  --contract-address 0x12296f2D128530a834460DF6c36a2895B793F26d \
  create \
  --private-key ac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80 \
  --threshold 2 \
  --participants 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC \
  --data 48656c6c6f
```

The CLI will:

1. Create the proposal and print the proposal ID
2. Watch for vote events in real-time
3. Wait for the deadline to pass
4. Automatically execute if threshold is met

### Cast a Vote

Vote on an existing proposal:

```bash
cargo run -- \
  --contract-address <deployed_contract_address> \
  --rpc-url {{default_rpc_url}} \
  vote \
  --private-key <voter_private_key> \
  --proposal-id <proposal_id> \
  --choice 1
```

Parameters:

- `--proposal-id`: The hex-encoded proposal ID from creation
- `--choice`: Your vote (0 or 1)

Example:

```bash
cargo run -- \
  --contract-address 0x12296f2D128530a834460DF6c36a2895B793F26d \
  vote \
  --private-key 59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d \
  --proposal-id 0xabc123... \
  --choice 1
```

## How Voting Works

1. **Proposal Creation**: Creator specifies deadline, threshold, eligible voters, and proposal data
2. **Voting Period**: Only registered voters can cast votes before the deadline
3. **Deadline Enforcement**: Pod's Time library ensures votes cannot be cast after deadline
4. **Vote Counting**: Fast counters track votes efficiently on-chain
5. **Execution**: After deadline, if threshold is met, proposal can be executed
6. **Finality**: Executed proposals cannot be re-executed

## Contract Details

- **Contract Name**: {{contract_name}}
- **Solidity Version**: ^0.8.28
- **Key Features**:
  - Time-based deadlines (microsecond precision)
  - Voter registration per proposal
  - Threshold-based execution
  - Duplicate vote prevention
  - Event emission for all actions

## Development

### Modifying the Contract

If you modify `{{contract_name}}.sol`:

1. Rebuild: `cd contract && forge build`
2. Test: `forge test -vvv`
3. Regenerate bindings: `make generate`
4. Rebuild client: `cd ../client && cargo build`

### Running Tests

Run the full Foundry test suite:

```bash
cd contract
forge test -vvv
```

Tests include:

- Proposal creation validation
- Voter access control
- Deadline enforcement
- Duplicate vote prevention
- Execution logic

## Customization Ideas

- Add vote delegation for proxy voting
- Implement weighted voting based on token holdings
- Support multi-choice voting (not just binary yes/no)
- Add proposal cancellation by proposer
- Implement quorum requirements
- Add hidden votes (revealed after deadline)
- Extend CLI with proposal querying
- Add snapshot-based voting power

## Dependencies

### Solidity Dependencies

- **pod-sdk** (Foundry): Time, FastTypes, and testing utilities

### Rust Dependencies (Client)

- **pod-sdk** (0.5.0): Pod Network SDK
- **pod-types** (0.3.0): Pod Network types
- **{{bindings_crate_name}}**: Auto-generated contract bindings
- **alloy** (1.0.36): Ethereum types
- **tokio** (1.45.1): Async runtime
- **clap** (4.5.38): CLI parsing

## Troubleshooting

### Bindings Not Found

If the client fails to build with "cannot find crate `{{bindings_crate_name}}`":

```bash
cd contract && make generate
```

### Contract Compilation Errors

Make sure Pod SDK is installed:

```bash
cd contract && forge install podnetwork/pod-sdk
```

### Time-Related Test Failures

Tests use `podWarp` for time manipulation. Ensure you're using the PodTest base contract.

## Resources

- [Pod Network Documentation]({{documentation}})
- [Pod Network Homepage]({{homepage}})
- [Repository]({{repository}})
- [Foundry Book](https://book.getfoundry.sh/)

## License

UNLICENSED

---

Generated on {{CURRENT_TIMESTAMP}}
